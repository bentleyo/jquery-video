/*


 jquery-video widget
 Copyright 2015-2016 DACHCOM.DIGITAL AG

 @author Volker Andres
 @author Marco Rieser
 @see https://github.com/dachcom-digital/jquery-video
 @license MIT
 @version 0.4.0
*/
(function(d){var e={_register:{},isRegistered:function(a){return void 0!==this._register[a]},isLoaded:function(a){return void 0!==this._register[a]&&!0===this._register[a]},register:function(a,b){this._register[a]=b||!1}};d.widget("dcd.video",{options:{classResponsive:"responsive"},_create:function(){var a=this;switch(this.element.data("type")){case "youtube":this.element.videoYoutube(this.options);this._player=this.element.data("dcd-videoYoutube");this.element.on("videoyoutubeready videoyoutubeplay videoyoutubepause videoyoutubeend",
function(b,c){a._trigger(c.event,b,[c])});break;case "vimeo":this.element.videoVimeo(this.options);this._player=this.element.data("dcd-videoVimeo");this.element.on("videovimeoready videovimeoplay videovimeopause videovimeoend",function(b,c){a._trigger(c.event,b,[c])});break;case "dailymotion":this.element.videoDailymotion(this.options);this._player=this.element.data("dcd-videoDailymotion");this.element.on("videodailymotionready videodailymotionplay videodailymotionpause videodailymotionend",function(b,
c){a._trigger(c.event,b,[c])});break;default:throw{name:"Video Error",message:"Unknown video type",toString:function(){return this.name+": "+this.message}};}},_initialize:function(){this._params=this.element.data("params")||{};this._code=this.element.data("code");this._width=this.element.data("width");this._height=this.element.data("height");this._autoplay=!!this.element.data("autoplay");this._rel=!!this.element.data("rel");this._playing=this._autoplay||!1;this._responsive=!1!==this.element.data("responsive");
!0===this._responsive&&this.element.addClass(this.options.classResponsive);this._calculateRatio()},play:function(){this._player.play()},pause:function(){this._player.pause()},stop:function(){this._player.stop()},playing:function(){return this._player.playing()},_calculateRatio:function(){this._responsive&&this.element.css("paddingBottom",this._height/this._width*100+"%")},_destroy:function(){this.element.off();this.element.removeAttr("style");this._player.destroy()}});d.widget("dcd.videoYoutube",
d.dcd.video,{_create:function(){var a=this;this._initialize();this.element.append("<div/>");this._on(window,{youtubeapiready:function(){void 0===a._player&&(a._autoplay&&(a._params.autoplay=1),a._rel||(a._params.rel=0),a._player=new YT.Player(a.element.children(":first")[0],{height:a._height,width:a._width,videoId:a._code,playerVars:a._params,events:{onReady:function(){a._trigger("ready",{},[{type:"youtube",event:"ready"}])},onStateChange:function(b){switch(window.parseInt(b.data,10)){case 0:a._playing=
!1;a._trigger("end",{},[{type:"youtube",event:"end"}]);break;case 1:a._playing=!0;a._trigger("play",{},[{type:"youtube",event:"play"}]);break;case 2:a._playing=!1,a._trigger("pause",{},[{type:"youtube",event:"pause"}])}a._trigger("statechange",{},b)}}}))}});this._loadApi()},_loadApi:function(){if(e.isRegistered("youtube"))e.isLoaded("youtube")&&d(window).trigger("youtubeapiready");else{e.register("youtube");var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=
!0;a.src=document.location.protocol+"//www.youtube.com/iframe_api";b.parentNode.insertBefore(a,b);window.onYouTubeIframeAPIReady=function(){d(window).trigger("youtubeapiready");e.register("youtube",!0)}}},play:function(){this._player.playVideo();this._playing=!0},pause:function(){this._player.pauseVideo();this._playing=!1},stop:function(){this._player.stopVideo();this._playing=!1;this._trigger("end",{},[{type:"youtube",event:"end"}])},playing:function(){return this._playing},_destroy:function(){this.element.removeAttr("style");
this.stop();this._player.destroy();this.element.off().empty()}});d.widget("dcd.videoVimeo",d.dcd.video,{_create:function(){var a=this;this._initialize();var b=(new Date).getTime(),c="";this._autoplay&&(c+="&autoplay=1");for(var e in this._params)this._params.hasOwnProperty(e)&&(c+="&"+e+"="+this._params[e]);this.element.append(d("<iframe/>").attr("frameborder",0).attr("id","vimeo"+this._code+b).attr("width",this._width).attr("height",this._height).attr("src",document.location.protocol+"//player.vimeo.com/video/"+
this._code+"?api=1&player_id=vimeo"+this._code+b+c));this._player=$f(this.element.children(":first")[0]);this._player.addEvent("ready",function(){a._trigger("ready",{},[{type:"vimeo",event:"ready"}]);a._player.addEvent("play",function(){a._playing=!0;a._trigger("play",{},[{type:"vimeo",event:"play"}])});a._player.addEvent("pause",function(){a._playing=!1;a._trigger("pause",{},[{type:"vimeo",event:"pause"}])});a._player.addEvent("finish",function(){a._playing=!1;a._trigger("end",{},[{type:"vimeo",
event:"end"}])})})},play:function(){this._player.api("play");this._playing=!0},pause:function(){this._player.api("pause");this._playing=!1},stop:function(){this._player.api("unload");this._playing=!1;this._trigger("end",{},[{type:"vimeo",event:"end"}])},playing:function(){return this._playing},_destroy:function(){this.element.removeAttr("style");this.stop();this.element.off().empty()}});d.widget("dcd.videoDailymotion",d.dcd.video,{_stopping:!1,_create:function(){var a=this;this._initialize();a._autoplay&&
(a._params.autoplay=1);a._rel||(a._params.related=0);this.element.append("<div/>");this._on(window,{dailymotionapiready:function(){void 0===a._player&&(a._player=DM.player(a.element.children(":first")[0],{height:a._height,width:a._width,video:a._code,params:a._params}),a._player.addEventListener("apiready",function(){a._trigger("ready",{},[{type:"dailymotion",event:"ready"}])}),a._player.addEventListener("play",function(){a._playing=!0;a._trigger("play",{},[{type:"dailymotion",event:"play"}])}),a._player.addEventListener("pause",
function(){a._playing=!1;!0===a._stopping?a._stopping=!1:a._trigger("pause",{},[{type:"dailymotion",event:"pause"}])}),a._player.addEventListener("end",function(){a._playing=!1;a._trigger("end",{},[{type:"dailymotion",event:"end"}])}))}});this._loadApi()},_loadApi:function(){if(e.isRegistered("dailymotion"))e.isLoaded("dailymotion")&&d(window).trigger("dailymotionapiready");else{e.register("dailymotion");var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0;
a.src=document.location.protocol+"//api.dmcdn.net/all.js";b.parentNode.insertBefore(a,b);window.dmAsyncInit=function(){d(window).trigger("dailymotionapiready");e.register("dailymotion",!0)}}},play:function(){this._player.play();this._playing=!0},pause:function(){this._player.pause();this._playing=!1},stop:function(){this.playing()&&(this._stopping=!0,this._player.pause(),this._player.seek(0));this._playing=!1;this._trigger("end",{},[{type:"dailymotion",event:"end"}])},playing:function(){return this._playing},
_destroy:function(){this.element.removeAttr("style");this.stop();this.element.off().empty()}})})(jQuery);
